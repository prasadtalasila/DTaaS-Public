# -*- mode: ruby -*-

# vi: set ft=ruby :

require 'json'
boxes = JSON.parse(File.read('boxes.json'))

Vagrant.configure(2) do |config|

  boxes.each do |opts|
    config.vm.define opts["name"] do |node|
      node.vm.box = "dtaas-base-box"
      node.vm.hostname = opts["hostname"]
      node.vm.network "public_network", :bridge => 'ens10f3', :mac => opts["mac"]

      node.vm.provider "virtualbox" do |vb|
        vb.memory = 6096
        vb.cpus = 3
        vb.name = opts["name"]
      end

      # remove the incorrect default gateway
      config.vm.provision "shell",
      inline: "ip route del default via 10.0.2.2 dev enp0s3"

      node.ssh.private_key_path = "vagrant"
      node.vm.provision "shell", privileged: false, path: opts["script"]
    end
  end

end

